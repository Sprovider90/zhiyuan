(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-635adc9c"],{"0049":function(t,s,e){},"083b":function(t,s,e){"use strict";var i=e("0049"),a=e.n(i);a.a},"572a":function(t,s,e){},6736:function(t,s,e){"use strict";var i=e("572a"),a=e.n(i);a.a},"6b48":function(t,s,e){"use strict";e.r(s);var i=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"msgDetail"},[e("div",{staticClass:"project-item"},[e("div",{staticClass:"item-title"},[t._v("项目信息")]),t._v(" "),e("ul",{staticClass:"info-list"},[e("li",[e("span",[t._v("预警事件")]),t._v(" "),e("span",[t._v(t._s(t.warningDetail.threshold_keys))])]),t._v(" "),e("li",[e("span",[t._v("所属项目")]),t._v(" "),e("span",[t._v(t._s(t.warningDetail.project_name))])]),t._v(" "),e("li",[e("span",[t._v("所属客户")]),t._v(" "),e("span",[t._v(t._s(t.warningDetail.customs_name))])]),t._v(" "),e("li",[e("span",[t._v("预警时间")]),t._v(" "),e("span",[t._v(t._s(t.warningDetail.warning_time))])]),t._v(" "),e("li",[e("span",[t._v("检测标准")]),t._v(" "),e("span",[t._v(t._s(t.warningDetail.thresholds_name))])]),t._v(" "),e("li",[e("span",[t._v("现场反馈时间")]),t._v(" "),e("span",[t._v(t._s(t.warningDetail.first_sms_time))])])])]),t._v(" "),e("div",{staticClass:"project-item"},[e("div",{staticClass:"item-title"},[t._v(t._s("send"==t.type?"发送消息":"信息"))]),t._v(" "),"send"==t.type?e("div",{staticClass:"feedback",on:{click:function(s){return t.handleDialog("https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1595012358313&di=52ea311799d3d1cec36dfc74c76f8b5b&imgtype=0&src=http%3A%2F%2Fc-ssl.duitang.com%2Fuploads%2Fitem%2F201612%2F26%2F20161226105255_F3eCQ.jpeg")}}},[t._v("\n            请尽可能详细反馈现场情况，点击查看现场反馈模板\n        ")]):t._e(),t._v(" "),"send"==t.type?e("div",{staticClass:"send-msg-box"},[e("div",{staticClass:"send-msg-content"},[e("el-input",{staticClass:"no-border",attrs:{maxlength:"9999",rows:"3",resize:"none",placeholder:"请输入文本",type:"textarea"},model:{value:t.sendMsgDetail.content,callback:function(s){t.$set(t.sendMsgDetail,"content",s)},expression:"sendMsgDetail.content"}}),t._v(" "),e("div",{staticClass:"send-img"},t._l(t.sendMsgDetail.picsPath,(function(s,i){return e("div",{key:s+i,staticClass:"send-img-box"},[e("uploadImg",{attrs:{idx:i,imgUrl:s},on:{afterUpload:t.sendAfterUpload,afterRemove:t.sendAfterRemove}})],1)})),0)],1),t._v(" "),e("div",{staticClass:"send-msg-btn"},[e("el-button",{attrs:{size:"small",type:"primary"},on:{click:t.handleSendMsg}},[t._v("发送信息")]),t._v(" "),e("el-button",{attrs:{size:"small"},on:{click:t.handleSendUpload}},[t._v("上传图片")])],1)]):t._e(),t._v(" "),e("ul",{staticClass:"msg-list"},t._l(t.msgList,(function(s,i){return e("li",{key:s.msgId,staticClass:"msg-item"},[e("div",{staticClass:"user-info"},[e("div",{staticClass:"user-img"},[e("img",{attrs:{src:s.user.img&&s.user.img.path||"https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1595009992994&di=f5efa6f786d5c7e328b04c92d0aa1883&imgtype=0&src=http%3A%2F%2Fb-ssl.duitang.com%2Fuploads%2Fitem%2F201410%2F09%2F20141009224754_AswrQ.jpeg",alt:""}})]),t._v(" "),e("p",{staticClass:"user-name"},[t._v(t._s(s.user.truename))])]),t._v(" "),e("div",{staticClass:"msg-info"},[s.isEdit&&"{}"!=JSON.stringify(t.editMsgItem)?[e("el-input",{staticClass:"no-border",attrs:{rows:"3",resize:"none",type:"textarea"},model:{value:t.editMsgItem.content,callback:function(s){t.$set(t.editMsgItem,"content",s)},expression:"editMsgItem.content"}}),t._v(" "),e("div",{staticClass:"edit-img-msg"},t._l(t.editMsgItem.picsPath,(function(s,i){return e("div",{key:s.id,staticClass:"edit-img-box"},[e("uploadImg",{attrs:{idx:i,imgUrl:s},on:{afterUpload:t.afterUpload,afterRemove:t.afterRemove}})],1)})),0)]:[e("p",{staticClass:"text-msg"},[t._v(t._s(s.content))]),t._v(" "),e("div",{staticClass:"img-msg"},t._l(s.pics_img,(function(s,i){return e("img",{key:i,attrs:{src:s.path,alt:""},on:{click:function(e){return t.handleDialog(s)}}})})),0)],t._v(" "),e("div",{staticClass:"msg-footer"},[e("p",{staticClass:"msg-time"},[t._v(t._s(s.updated_at))]),t._v(" "),"send"==t.type?e("div",{staticClass:"msg-btn"},[s.isEdit?[e("el-button",{attrs:{size:"small"},on:{click:t.handleEditUpload}},[t._v("上传图片")]),t._v(" "),e("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(e){return t.handleSaveEdit(s,i)}}},[t._v("确定")]),t._v(" "),e("el-button",{attrs:{size:"small"},on:{click:function(e){return t.handleCancleEdit(s)}}},[t._v("取消")])]:t._e(),t._v(" "),s.isEdit||s.user.id!==t.memberId?t._e():e("el-button",{attrs:{size:"small"},on:{click:function(e){return t.handleEditMsg(s)}}},[t._v("编辑")])],2):t._e()])],2)])})),0),t._v(" "),e("myPagination",{attrs:{pageInfo:t.pageInfo},on:{"current-change":t.pageChange}})],1),t._v(" "),e("el-dialog",{attrs:{visible:t.dialogVisible},on:{"update:visible":function(s){t.dialogVisible=s}}},[e("img",{attrs:{width:"100%",src:t.bigImgUrl,alt:""}})])],1)},a=[],n=(e("cc57"),e("82e5")),c=e("b775"),l=e("de9f"),o={name:"msgDetail",data:function(){return{warnig_id:"",memberId:0,dialogVisible:!1,bigImgUrl:"",type:"",msgList:[],editMsgItem:{content:"",picsPath:[],picsId:[]},sendMsgDetail:{content:"",picsPath:[],picsId:[]},warningDetail:{threshold_keys:"",project_name:"",customs_name:"",warning_time:"",thresholds_name:"",feedback_time:""},pageInfo:{total:0,pageSize:10,currentPage:1}}},created:function(){this.type=this.$route.query.type,this.warnig_id=this.$route.params.id,this.memberId=this.$store.getters.admin_detail.id,this.getMsgList(),this.getWarningDetail()},methods:{getWarningDetail:function(){var t=this;Object(c["a"])(this.ajaxUrl.warningDetail+this.warnig_id,{},"get").then((function(s){console.log(s,1111),t.warningDetail={threshold_keys:s.threshold_keys,project_name:s.project&&s.project.name,customs_name:s.project&&s.project.customs[0]&&s.project.customs[0].company_name,warning_time:s.waring_time,first_sms_time:s.first_sms_time,thresholds_name:s.thresholds_name}})).catch((function(t){console.log(t)}))},afterUpload:function(t,s){this.editMsgItem.picsId[s]=t.id,this.editMsgItem.picsPath[s]=t.path},afterRemove:function(t){this.editMsgItem.picsId.splice(t,1),this.editMsgItem.picsPath.splice(t,1)},sendAfterUpload:function(t,s){this.sendMsgDetail.picsId[s]=t.id,this.sendMsgDetail.picsPath[s]=t.path},sendAfterRemove:function(t){this.sendMsgDetail.picsPath.splice(t,1),this.sendMsgDetail.picsId.splice(t,1)},handleDialog:function(t){this.bigImgUrl=t.path,this.dialogVisible=!0},getMsgList:function(){var t=this;Object(c["a"])(this.ajaxUrl.warningMsgist,{warnig_id:this.warnig_id,pageSize:this.pageInfo.pageSize,page:this.pageInfo.currentPage},"get").then((function(s){t.msgList=s.data.map((function(t,s){return t.isEdit=!1,t})),t.pageInfo.total=s.meta.total})).catch((function(t){console.log(t)}))},pageChange:function(t){this.pageInfo.currentPage=t,this.getMsgList()},handleEditMsg:function(t){var s;this.msgList.map((function(e,i){e.id!=t.id?e.isEdit=!1:s=i})),this.$set(this.msgList[s],"isEdit",!0),this.editMsgItem={content:t.content,picsId:t.pics_img.map((function(t){return t.id})),picsPath:t.pics_img.map((function(t){return t.path}))},console.log(this.editMsgItem)},handleEditUpload:function(){this.editMsgItem.picsId.length>=10?this.$message.warning("最多只能上传10长图片"):(this.editMsgItem.picsId.push(""),this.editMsgItem.picsPath.push(""))},handleSendUpload:function(){this.sendMsgDetail.picsId.length>=10?this.$message.warning("最多只能上传10长图片"):(this.sendMsgDetail.picsId.push(""),this.sendMsgDetail.picsPath.push(""))},handleCancleEdit:function(t){t.isEdit=!1,this.editMsgItem={}},handleSaveEdit:function(t,s){var e=this;this.msgList[s].isEdit=!1,Object(c["a"])(this.ajaxUrl.editWarningMsg+this.warnig_id+"/warnigssms/"+t.id,{content:this.editMsgItem.content,pics:this.editMsgItem.picsId.join(",")},"patch").then((function(t){e.$message.success("编辑成功"),e.getMsgList()})).catch((function(t){console.log(t)}))},handleSendMsg:function(){var t=this;JSON.parse(JSON.stringify(this.sendMsgDetail));Object(c["a"])(this.ajaxUrl.sendWarningMsg+this.warnig_id+"/warnigssms",{content:this.sendMsgDetail.content,pics:this.sendMsgDetail.picsId.join(",")},"post").then((function(s){t.$message.success("发送成功"),t.sendMsgDetail={content:"",picsPath:[],picsId:[]},t.getMsgList()})).catch((function(t){console.log(t)}))}},components:{uploadImg:n["a"],myPagination:l["a"]}},d=o,r=(e("083b"),e("9ca4")),g=Object(r["a"])(d,i,a,!1,null,"c893b7a6",null);s["default"]=g.exports},de9f:function(t,s,e){"use strict";var i=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"myPagination"},[e("div",{staticClass:"total"},[t._v("\n        共"+t._s(t.pageInfo.total)+"条数据，"+t._s(Math.ceil(t.pageInfo.total/t.pageInfo.pageSize))+"页\n    ")]),t._v(" "),e("el-pagination",{attrs:{background:"",layout:"prev, pager, next","page-size":t.pageInfo.pageSize,"current-page":t.pageInfo.currentPage,total:t.pageInfo.total},on:{"current-change":t.handleCurrentChange}})],1)},a=[],n={name:"myPagination",props:["pageInfo"],data:function(){return{}},created:function(){},methods:{handleCurrentChange:function(t){this.$emit("current-change",t)}}},c=n,l=(e("6736"),e("9ca4")),o=Object(l["a"])(c,i,a,!1,null,"dabd56de",null);s["a"]=o.exports}}]);