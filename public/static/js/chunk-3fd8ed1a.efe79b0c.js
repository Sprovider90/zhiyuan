(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3fd8ed1a"],{"572a":function(e,t,a){},6736:function(e,t,a){"use strict";var n=a("572a"),i=a.n(n);i.a},"88f3":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"earlyWarning mainPage"},[e.showParent?[a("div",{staticClass:"filterBox"},[a("el-input",{staticClass:"keywords fr",attrs:{size:"small",placeholder:"输入项目名称查询"},model:{value:e.searchInfo.name,callback:function(t){e.$set(e.searchInfo,"name",t)},expression:"searchInfo.name"}},[a("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.handleSearch},slot:"append"})],1)],1),e._v(" "),a("div",{staticClass:"tableContent"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,border:""}},[a("el-table-column",{attrs:{label:"编号",type:"index",width:"80"}}),e._v(" "),a("el-table-column",{attrs:{prop:"name",label:"项目名称"}}),e._v(" "),a("el-table-column",{attrs:{prop:"customer",label:"所属客户"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[e._v(e._s(t.row.customs[0]&&t.row.customs[0].company_name))])]}}],null,!1,2018681120)}),e._v(" "),a("el-table-column",{attrs:{label:"预警提醒时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[e._v(e._s(0===t.row.waringsetting.length?"--":0!=t.row.waringsetting[0].remind_time?t.row.waringsetting[0].remind_time/60+"小时":"每次预警都提醒"))])]}}],null,!1,2021185721)}),e._v(" "),a("el-table-column",{attrs:{label:"预警提醒百分比"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[e._v(e._s(0===t.row.waringsetting.length?"--":(100*t.row.waringsetting[0].percentage).toFixed(0)+"%"))])]}}],null,!1,1282808877)}),e._v(" "),a("el-table-column",{attrs:{label:"预警通知时间段"},scopedSlots:e._u([{key:"default",fn:function(t){return[0===t.row.waringsetting.length?a("span",[e._v("--")]):a("span",[e._v("\n                            "+e._s(e.initTimeSolt(t.row.waringsetting[0].notice_start_time,t.row.waringsetting[0].notice_end_time))+"\n                        ")])]}}],null,!1,675420629)}),e._v(" "),a("el-table-column",{attrs:{label:"操作",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{directives:[{name:"btnRole",rawName:"v-btnRole",value:7,expression:"7"}],attrs:{type:"text",size:"mini"},on:{click:function(a){return e.$router.push({name:"setWarning",params:{id:t.row.id}})}}},[e._v("阈值设置")]),e._v(" "),a("el-button",{directives:[{name:"btnRole",rawName:"v-btnRole",value:8,expression:"8"}],attrs:{type:"text",size:"mini"},on:{click:function(a){return e.handleSet(t.row)}}},[e._v("预警条件")])]}}],null,!1,2311568509)})],1),e._v(" "),a("myPagination",{attrs:{pageInfo:e.pageInfo},on:{"current-change":e.pageChange}})],1),e._v(" "),a("el-dialog",{attrs:{title:"预警条件",visible:e.dialogVisible,"close-on-click-modal":!1,width:"600px"},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("el-form",{ref:"earlyWarningForm",staticClass:"warehouseForm form-inline",attrs:{model:e.formData,rules:e.rules,"label-position":"top","label-width":"100px"}},[a("el-form-item",{staticClass:"form-item-inline",attrs:{label:"预警提醒时间设置",prop:"remind_time"}},[a("el-select",{attrs:{size:"small",placeholder:"请选择预警提醒时间"},model:{value:e.formData.remind_time,callback:function(t){e.$set(e.formData,"remind_time",t)},expression:"formData.remind_time"}},[a("el-option",{attrs:{label:"每次预警都提示",value:0}}),e._v(" "),e._l(24,(function(e){return a("el-option",{key:e,attrs:{label:e+"小时",value:e}})}))],2)],1),e._v(" "),a("el-form-item",{staticClass:"form-item-inline",attrs:{label:"预警提醒百分比设置",prop:"percentage"}},[a("el-select",{attrs:{size:"small",placeholder:"请选择预警提醒百分比"},model:{value:e.formData.percentage,callback:function(t){e.$set(e.formData,"percentage",t)},expression:"formData.percentage"}},e._l(e.percentages,(function(e,t){return a("el-option",{key:t,attrs:{label:(100*e).toFixed(0)+"%",value:e}})})),1)],1),e._v(" "),a("el-form-item",{staticClass:"form-item-inline",attrs:{label:"预警通知时间段",prop:"time_slot"}},[a("el-time-picker",{attrs:{size:"small","is-range":"",format:"HH:mm","value-format":"HH:mm","range-separator":"","start-placeholder":"","end-placeholder":"",placeholder:"选择时间段"},model:{value:e.formData.time_slot,callback:function(t){e.$set(e.formData,"time_slot",t)},expression:"formData.time_slot"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"预警消息接收人",prop:"phones"}},[a("el-input",{attrs:{size:"small",placeholder:"请填入电话号码，多个号码以逗号隔开"},model:{value:e.formData.phones,callback:function(t){e.$set(e.formData,"phones","string"===typeof t?t.trim():t)},expression:"formData.phones"}})],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{size:"small"},on:{click:e.handleCancel}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.handleSubmit}},[e._v("提交")])],1)],1)],1)]:e._e(),e._v(" "),a("router-view")],2)},i=[],r=(a("f548"),a("163d"),a("9a33"),a("cc57"),a("de9f")),o=a("b775"),l={name:"earlyWarning",data:function(){return{showParent:!0,dialogVisible:!1,searchInfo:{name:""},percentages:[.6,.7,.8,.9,1,1.1,1.2,1.3,1.4,1.5],formData:{remind_time:2,percentage:1,time_slot:["00:00","23:59"],phones:""},warningSetInfo:{},rules:{remind_time:[{required:!0,message:"请选择预警提醒时间",trigger:"blur"}],percentage:[{required:!0,message:"请选择预警提醒百分比",trigger:"blur"}],time_slot:[{required:!0,message:"请选择预警通知时间段",trigger:"blur"}],phones:[{required:!0,message:"请输入预警消息接收人",trigger:"blur"}]},tableData:[],setMethod:"post",pageInfo:{total:0,pageSize:20,currentPage:1}}},mounted:function(){"earlyWarning"===this.$route.name?(this.showParent=!0,this.getProjectsWarningList()):this.showParent=!1},methods:{resetForm:function(){this.formData={remind_time:2,percentage:1,time_slot:["00:00","23:59"],phones:""}},handleSet:function(e){this.dialogVisible=!0,this.warningSetInfo=e;var t=e.waringsetting[0];0===e.waringsetting.length?(this.setMethod="post",this.resetForm()):(this.setMethod="patch",this.formData.remind_time=t.remind_time/60,this.formData.percentage=t.percentage/1,this.formData.time_slot=this.initTimeSolt(t.notice_start_time,t.notice_end_time).split("--"),this.formData.phones=t.notice_phone)},initTimeSolt:function(e,t){var a=("000"+e).slice(-4).split(""),n=("000"+t).slice(-4).split("");return a.splice(2,0,":"),n.splice(2,0,":"),a.join("")+"--"+n.join("")},handleSearch:function(){this.pageInfo.currentPage=1,this.getProjectsWarningList()},getProjectsWarningList:function(){var e=this;Object(o["a"])(this.ajaxUrl.projectsWarning,{include:"customs,thresholds,waringsetting",page:this.pageInfo.currentPage,pageSize:this.pageInfo.pageSize,name:this.searchInfo.name},"get").then((function(t){e.tableData=t.data,e.pageInfo.total=t.meta.total})).catch((function(e){console.log(e)}))},pageChange:function(e){this.pageInfo.currentPage=e,this.getProjectsWarningList()},handleSubmit:function(){var e=this;this.$refs["earlyWarningForm"].validate((function(t){if(!t)return!1;console.log("验证通过,提交");var a=e.warningSetInfo.waringsetting,n=0===a.length?e.ajaxUrl.warningSet+e.warningSetInfo.id+"/waringsetting":e.ajaxUrl.warningSet+e.warningSetInfo.id+"/waringsetting/"+a[0].id;Object(o["a"])(n,{remind_time:60*e.formData.remind_time,percentage:e.formData.percentage,notice_start_time:Number(e.formData.time_slot[0].replace(":","")),notice_end_time:Number(e.formData.time_slot[1].replace(":","")),notice_phone:e.formData.phones},e.setMethod).then((function(t){e.$message.success("预警条件设置成功"),e.dialogVisible=!1,e.getProjectsWarningList()})).catch((function(e){console.log(e)}))}))},handleCancel:function(){this.dialogVisible=!1}},components:{myPagination:r["a"]}},s=l,c=(a("b166"),a("9ca4")),m=Object(c["a"])(s,n,i,!1,null,"9492e56e",null);t["default"]=m.exports},b166:function(e,t,a){"use strict";var n=a("f15b"),i=a.n(n);i.a},de9f:function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"myPagination"},[a("div",{staticClass:"total"},[e._v("\n        共"+e._s(e.pageInfo.total)+"条数据，"+e._s(Math.ceil(e.pageInfo.total/e.pageInfo.pageSize))+"页\n    ")]),e._v(" "),a("el-pagination",{attrs:{background:"",layout:"prev, pager, next","page-size":e.pageInfo.pageSize,"current-page":e.pageInfo.currentPage,total:e.pageInfo.total},on:{"current-change":e.handleCurrentChange}})],1)},i=[],r={name:"myPagination",props:["pageInfo"],data:function(){return{}},created:function(){},methods:{handleCurrentChange:function(e){this.$emit("current-change",e)}}},o=r,l=(a("6736"),a("9ca4")),s=Object(l["a"])(o,n,i,!1,null,"dabd56de",null);t["a"]=s.exports},f15b:function(e,t,a){}}]);