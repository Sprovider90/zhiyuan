(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4d8e6955"],{"5ab4":function(t,i,e){"use strict";var s=e("e1c7"),n=e.n(s);n.a},9235:function(t,i,e){"use strict";e.r(i);var s=function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",{staticClass:"monitorManager"},[e("div",{staticClass:"project-item"},[e("div",{staticClass:"item-title"},[t._v("项目信息")]),t._v(" "),e("ul",{staticClass:"info-list"},[e("li",[e("span",[t._v("项目编号")]),t._v(" "),e("span",[t._v(t._s(t.monitorInfo.number))])]),t._v(" "),e("li",[e("span",[t._v("项目名称")]),t._v(" "),e("span",[t._v(t._s(t.monitorInfo.name))])]),t._v(" "),e("li",[e("span",[t._v("所属客户")]),t._v(" "),e("span",[t._v(t._s(t.monitorInfo.customs[0]&&t.monitorInfo.customs[0].company_name))])]),t._v(" "),e("li",[e("span",[t._v("项目地址")]),t._v(" "),e("span",[t._v(t._s(t.monitorInfo.address))])]),t._v(" "),e("li",[e("span",[t._v("项目状态")]),t._v(" "),e("span",{staticClass:"monitor-status text-dot",class:"color"+t.monitorInfo.status},[t._v(t._s(t.publicObj.projectStatus[t.monitorInfo.status]))])]),t._v(" "),t._m(0)])]),t._v(" "),e("div",{staticClass:"project-item"},[e("div",{staticClass:"item-title"},[e("span",[t._v("点位信息")]),t._v(" "),e("el-button",{attrs:{size:"small"},on:{click:t.handleAddMoitor}},[t._v("+新增点位")])],1),t._v(" "),e("ul",{staticClass:"monitor-list"},t._l(t.monitorList,(function(i,s){return e("li",{key:i.id+""+s,staticClass:"monitor-item"},[e("div",{staticClass:"monitor-id"},[e("span",[e("span",[t._v(t._s(i.number))]),t._v(" "),0!==i.status?e("span",{staticClass:"text-dot",class:1===i.status?"start":"stop"},[t._v(t._s(1===i.status?"已启用":"已停用"))]):t._e()]),t._v(" "),0===i.status?e("el-button",{attrs:{type:"text"},on:{click:function(i){return t.handleDelMonitor(s)}}},[e("i",{staticClass:"el-icon-delete"}),t._v("删除")]):t._e(),t._v(" "),1===i.status?e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.handleChangeStatus(s,i,2)}}},[e("i",{staticClass:"el-icon-video-pause"}),t._v("停用")]):t._e(),t._v(" "),2===i.status?e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.handleChangeStatus(s,i,1)}}},[e("i",{staticClass:"el-icon-video-play"}),t._v("启用")]):t._e()],1),t._v(" "),e("div",{staticClass:"detail-list"},[e("div",{staticClass:"detail-item"},[e("span",{staticClass:"detail-tit required"},[t._v("点位名称")]),t._v(" "),e("el-input",{staticStyle:{width:"320px"},attrs:{disabled:2===i.status,type:"text",placeholder:"请输入点位名称",size:"small"},model:{value:i.name,callback:function(e){t.$set(i,"name","string"===typeof e?e.trim():e)},expression:"item.name"}})],1),t._v(" "),e("div",{staticClass:"detail-item"},[e("span",{staticClass:"detail-tit required"},[t._v("所在区域")]),t._v(" "),e("el-select",{attrs:{disabled:2===i.status,placeholder:"请选择",size:"small"},model:{value:i.area_id,callback:function(e){t.$set(i,"area_id",e)},expression:"item.area_id"}},t._l(t.areasList,(function(t){return e("el-option",{key:t.id,attrs:{label:t.area_name,value:t.id}})})),1),t._v(" "),2!==i.status?e("el-button",{attrs:{size:"small"},on:{click:function(e){return t.handleEditPosition(i,s)}}},[t._v("编辑点位")]):t._e()],1),t._v(" "),e("div",{staticClass:"detail-item"},[e("span",{staticClass:"detail-tit required"},[t._v("绑定产品")]),t._v(" "),e("el-select",{attrs:{disabled:"",value:"1",placeholder:"请选择",size:"small"}},[e("el-option",{attrs:{label:"全能空气检测器",value:"1"}}),t._v(" "),e("el-option",{attrs:{label:"不全能的检测器",value:"2"}})],1)],1),t._v(" "),e("div",{staticClass:"detail-item"},[e("span",{staticClass:"detail-tit required"},[t._v("绑定设备")]),t._v(" "),e("el-select",{attrs:{disabled:2===i.status,placeholder:"请选择",size:"small"},model:{value:i.device_id,callback:function(e){t.$set(i,"device_id",e)},expression:"item.device_id"}},t._l(t.devicesList,(function(t){return e("el-option",{directives:[{name:"show",rawName:"v-show",value:!(1===t.position_flg&&1===t.run_status),expression:"!(deviceItem.position_flg===1 && deviceItem.run_status===1)"}],key:t.id,attrs:{label:t.device_number,value:t.id}})})),1)],1),t._v(" "),2!==i.status?e("div",{staticClass:"detail-btn"},[e("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(e){return t.handleSavePosition(s,i)}}},[t._v("保存")])],1):t._e()])])})),0),t._v(" "),e("div",{staticClass:"monitor-btn"},[e("el-button",{attrs:{size:"small"},on:{click:function(i){return t.$router.replace({name:"projectList"})}}},[t._v("返回")])],1)]),t._v(" "),e("el-dialog",{attrs:{visible:t.dialogVisible,"close-on-click-modal":!1,width:"40%"},on:{"update:visible":function(i){t.dialogVisible=i}}},[e("div",{staticClass:"monitor-position"},[e("div",{staticClass:"position-title"},[e("strong",[t._v("编辑点位")]),t._v("\n                请拖动"),e("span",{staticClass:"blue"},[t._v("蓝色坐标")]),t._v("确定设备位置("),e("span",{staticClass:"red"},[t._v("红色")]),t._v("为其他设备)\n            ")]),t._v(" "),e("monitor-position",{attrs:{options:t.options},on:{determine:t.handleDetermine}})],1)])],1)},n=[function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("li",[e("span",[t._v("创建时间")]),t._v(" "),e("span",[t._v("2020-05-30 13:03:56")])])}],o=(e("cc57"),function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",{staticClass:"monitorPosition",attrs:{click:"$event.preventDefault()"}},[e("div",{staticClass:"imgBox"},[e("img",{attrs:{src:t.options.img,alt:""}}),t._v(" "),t._l(t.options.others,(function(t){return e("i",{key:t.id,staticClass:"icon icon-other-position dot other-dot",style:{left:t.left,top:t.top}})})),t._v(" "),e("i",{ref:"defaultDot",staticClass:"icon icon-my-position dot default-dot",style:t.defaultPosition})],2),t._v(" "),e("div",{staticClass:"btnBox"},[e("el-button",{attrs:{type:"primary"},on:{click:t.handleSure}},[t._v("确定")]),t._v(" "),e("el-button",{on:{click:t.handleCancle}},[t._v("取消")])],1)])}),a=[],l=e("3de1"),c={name:"dialogCom",props:["options"],data:function(){return{}},mounted:function(){Object(l["f"])(this.$refs.defaultDot)},updated:function(){},computed:{defaultPosition:function(){return{left:this.options.position.left||"50%",top:this.options.position.top||"50%"}}},methods:{handleSure:function(){this.$emit("determine",Object(l["e"])(this.$refs.defaultDot))},handleCancle:function(){this.$emit("determine")}}},r=c,d=(e("5ab4"),e("9ca4")),u=Object(d["a"])(r,o,a,!1,null,"dbc28a32",null),p=u.exports,v=e("b775"),_={name:"monitorManager",data:function(){return{monitorList:[],areasList:[],devicesList:[],monitorIdx:0,dialogVisible:!1,options:{img:"",others:[],position:{left:"",top:""}},project_id:"",monitorInfo:{customs:[]},defaultMonitorList:[],lastNumber:0,customer_id:""}},created:function(){this.project_id=this.$route.params.id,this.getMonitorInfo(),this.getAreasList()},methods:{getAreasList:function(){var t=this;Object(v["a"])(this.ajaxUrl.areasList,{project_id:this.project_id},"get").then((function(i){t.areasList=i})).catch((function(t){console.log(t)}))},getDevicesList:function(){var t=this;Object(v["a"])(this.ajaxUrl.devicesList,{customer_id:this.customer_id},"get").then((function(i){t.devicesList=i})).catch((function(t){console.log(t)}))},getMonitorInfo:function(){var t=this;Object(v["a"])(this.ajaxUrl.positionsInfo+this.project_id+"/positions",{},"get").then((function(i){var e=[];t.monitorInfo=i,t.monitorList=i.position.map((function(t){return e.push(t.number.slice(-5)),t.position={},t})),t.lastNumber=0===e.length?0:Math.max.apply(Math,e),t.defaultMonitorList=JSON.parse(JSON.stringify(t.monitorList)),t.customer_id=i.customs[0].id,t.getDevicesList()})).catch((function(t){console.log(t)}))},handleSavePosition:function(t,i){var e=this;if(i.id)if(JSON.stringify(i)===JSON.stringify(this.defaultMonitorList[t]))this.$message.warning("未做任何更改");else{if(!this.checkPosition(i))return;Object(v["a"])(this.ajaxUrl.editPosition+i.id,{project_id:i.project_id,number:i.number,name:i.name,device_id:i.device_id,area_id:i.area_id,left:i.position.left,top:i.position.top,status:i.status},"put").then((function(i){e.$message.success("点位信息修改成功"),e.defaultMonitorList[t]=i,e.getDevicesList()})).catch((function(t){console.log(t)}))}else{if(!this.checkPosition(i))return;Object(v["a"])(this.ajaxUrl.addPosition,{project_id:i.project_id,number:i.number,name:i.name,device_id:i.device_id,area_id:i.area_id,left:i.position.left,top:i.position.top}).then((function(t){i.status=1,i.id=t.id,e.getDevicesList(),e.$message.success("点位信息保存成功")})).catch((function(t){console.log(t)}))}},checkPosition:function(t){return t.name?t.area_id?t.device_id?""!==t.position.left&&""!==t.position.top||(this.$message.warning("请设置点位位置"),!1):(this.$message.warning("请选择绑定设备"),!1):(this.$message.warning("请选择所在区域"),!1):(this.$message.warning("请输入点位名称"),!1)},handleAddMoitor:function(){var t=this.monitorInfo.number+("0000"+ ++this.lastNumber).slice(-5);this.monitorList.unshift({id:"",number:t,name:"",area_id:"",project_id:this.project_id,device_id:"",status:0,position:{left:"",top:""}})},handleDelMonitor:function(t){var i=this;this.$confirm("删除后数据无法恢复，请谨慎操作","确定删除点位",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){i.monitorList.splice(t,1)})).catch((function(){}))},handleChangeStatus:function(t,i,e){var s=this,n=1===e?"确定启用该点位？":"确定停用该点位？";this.$confirm(n,(1===e?"启用":"停用")+"点位",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(v["a"])(s.ajaxUrl.positionStatusChange+i.id+"/status",{status:e},"put").then((function(i){s.monitorList[t].status=e,s.getDevicesList()})).catch((function(t){console.log(t)}))})).catch((function(){}))},handleEditPosition:function(t,i){var e=this;t.area_id?Object(v["a"])(this.ajaxUrl.areaLocation+t.project_id+"/area/"+t.area_id+"/location",{},"get").then((function(s){if(e.monitorIdx=i,e.options.img=s.area.file.path,e.dialogVisible=!0,t.id){console.log(t);var n={},o=[];s.all_device.map((function(i){t.id==i.position_id?n=i:o.push(i)})),e.options.position.left=n.left,e.options.position.top=n.top,e.options.others=JSON.parse(JSON.stringify(o))}else console.log("新增点位"),e.options.others=s.all_device})).catch((function(t){console.log(t)})):this.$message.warning("请先选择区域")},handleDetermine:function(t){this.dialogVisible=!1,t&&(this.monitorList[this.monitorIdx].position.left=t.left,this.monitorList[this.monitorIdx].position.top=t.top)}},components:{monitorPosition:p}},m=_,f=(e("9748"),Object(d["a"])(m,s,n,!1,null,"4f8d4592",null));i["default"]=f.exports},9748:function(t,i,e){"use strict";var s=e("ab87"),n=e.n(s);n.a},ab87:function(t,i,e){},e1c7:function(t,i,e){}}]);